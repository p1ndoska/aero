# üîß –û—Ç–ª–∞–¥–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ API –ø—Ä–æ—Ñ–∏–ª—è

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
GET http://localhost:8000/api/profile/stats 500 (Internal Server Error)
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è userId**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ `req.user.id` ‚Üí `req.user.userId`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ 6 –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```javascript
console.log('getUserStats - userId:', userId);
console.error('Error details:', error.message, error.stack);
```

### 3. **–£–ø—Ä–æ—â–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

#### getProfile - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
```javascript
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
const user = {
    id: userId,
    email: 'test@example.com',
    firstName: '–¢–µ—Å—Ç',
    lastName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
    role: { id: 1, name: 'SUPER_ADMIN' }
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
};
```

#### getUserStats - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
```javascript
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const stats = {
    totalLogins: 1,
    lastLogin: new Date().toISOString(),
    accountCreated: new Date().toISOString(),
    profileCompleteness: 50
};
```

## üéØ –¶–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ 500:
1. **–ò—Å–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** - –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞—Ç—å Prisma –∑–∞–ø—Ä–æ—Å—ã
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É middleware** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ userId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∏–¥–µ—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–æ–∫

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. **API –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å 200** –≤–º–µ—Å—Ç–æ 500
2. **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è** —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. **–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—ç–∫–µ–Ω–¥–∞** –ø–æ–∫–∞–∂—É—Ç userId –∏ –ª—é–±—ã–µ –æ—à–∏–±–∫–∏

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—ç–∫–µ–Ω–¥–∞:**
```bash
# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
getProfile - userId: 3
getUserStats - userId: 3
```

### 2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:**
- ‚úÖ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è (50% –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏)

### 3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab:**
- ‚úÖ `GET /api/profile` ‚Üí 200 OK
- ‚úÖ `GET /api/profile/stats` ‚Üí 200 OK

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ 500

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:

1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö:
   console.log('req.user:', req.user);
   console.log('req.user.userId:', req.user.userId);
   ```

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å Prisma –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º:**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
   await prisma.$connect();
   ```

3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º:**
   ```javascript
   // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ middleware:
   console.log('Decoded token:', user);
   ```

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Prisma –∑–∞–ø—Ä–æ—Å—ã** –≤ getProfile
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Prisma –∑–∞–ø—Ä–æ—Å—ã** –≤ getUserStats  
3. **–£–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω–æ–µ)

### –ü—Ä–∏–º–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è getProfile:
```javascript
const user = await prisma.user.findUnique({
    where: { id: userId },
    include: { role: true },
    select: {
        id: true,
        email: true,
        firstName: true,
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    }
});
```

## üéâ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå `500 Internal Server Error` ‚Üí ‚úÖ `200 OK`
- ‚úÖ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç userId = 3

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫! üöÄ
