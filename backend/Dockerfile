# Dockerfile for Backend
FROM node:18-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including devDependencies for Prisma)
RUN npm ci

# Copy Prisma schema
COPY prisma ./prisma

# Generate Prisma Client (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç DATABASE_URL, —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—É)
RUN npx prisma generate

# Copy application code
COPY . .

# Create uploads directory
RUN mkdir -p uploads

# Expose port
EXPOSE 3000

# Run migrations, initialize database, and start server
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
CMD ["sh", "-c", "echo 'üöÄ –ó–∞–ø—É—Å–∫ backend...' && node scripts/ensure-database.js && echo ' –ë–î –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞/—Å–æ–∑–¥–∞–Ω–∞' && npx prisma migrate deploy && echo ' –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã' && node scripts/initialize-db.js && echo ' –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞' && echo 'üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...' && node ./bin/www"]
