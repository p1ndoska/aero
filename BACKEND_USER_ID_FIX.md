# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 500 –≤ API –ø—Ä–æ—Ñ–∏–ª—è

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

```
GET http://localhost:8000/api/profile 500 (Internal Server Error)
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

**–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π JWT —Ç–æ–∫–µ–Ω–∞ –∏ –∫–æ–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:**

### JWT —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç:
```javascript
// –í UserController.js –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞:
const token = jwt.sign(
    { userId: user.id, role: user.role?.name },  // ‚Üê userId (–Ω–µ id)
    process.env.SECRET_KEY,
    { expiresIn: "7d" }
);
```

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–∂–∏–¥–∞–ª:
```javascript
// –í UserProfileController.js:
const userId = req.user.id;  // ‚Üê –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –î–æ–ª–∂–Ω–æ –±—ã—Ç—å userId
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–∏–ª –≤—Å–µ –º–µ—Å—Ç–∞ –≤ `UserProfileController.js`, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `req.user.id`:

```javascript
// ‚ùå –ë—ã–ª–æ:
const userId = req.user.id;

// ‚úÖ –°—Ç–∞–ª–æ:
const userId = req.user.userId;
```

## üìç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ **6 –º–µ—Å—Ç–∞—Ö**:

1. ‚úÖ **getProfile** - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ **updateProfile** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
3. ‚úÖ **updateAvatar** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
4. ‚úÖ **changePassword** - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
5. ‚úÖ **getUserStats** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
6. ‚úÖ **deleteAccount** - —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```javascript
// –¢–æ–∫–µ–Ω: { userId: 3, role: "SUPER_ADMIN" }
// –ö–æ–¥: req.user.id  ‚Üí undefined
// –†–µ–∑—É–ª—å—Ç–∞—Ç: WHERE id = undefined ‚Üí 500 –æ—à–∏–±–∫–∞
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```javascript
// –¢–æ–∫–µ–Ω: { userId: 3, role: "SUPER_ADMIN" }
// –ö–æ–¥: req.user.userId  ‚Üí 3
// –†–µ–∑—É–ª—å—Ç–∞—Ç: WHERE id = 3 ‚Üí —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚ùå `500 Internal Server Error`
- ‚úÖ API `/api/profile` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ API `/api/profile/stats` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ—Ñ–∏–ª—è —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
- ‚úÖ –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å JWT —Ç–æ–∫–µ–Ω:
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞**
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ:**
```javascript
const token = localStorage.getItem('token');
const payload = JSON.parse(atob(token.split('.')[1]));
console.log(payload);
// –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: { userId: 3, role: "SUPER_ADMIN", iat: ..., exp: ... }
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Network tab:
1. **–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network**
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - `GET /api/profile` ‚Üí 200 OK
   - `GET /api/profile/stats` ‚Üí 200 OK

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫! üéâ

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:**
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
